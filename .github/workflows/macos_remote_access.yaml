name: macOS - Tailscale & RustDesk Remote Access

on:
  # Permite ejecutar este flujo de trabajo manualmente desde la pesta√±a 'Actions'
  workflow_dispatch:

jobs:
  remote_session:
    name: Iniciar Sesi√≥n Remota (M√°x 6 Horas)
    runs-on: macos-latest
    # Tiempo m√°ximo de ejecuci√≥n permitido por GitHub (360 minutos = 6 horas)
    timeout-minutes: 360

    steps:
      # 1. Configurar e Instalar Tailscale
      - name: üöÄ Instalar y Configurar Tailscale
        env:
          # Se usa el secreto que ya has configurado
          TAILSCALE_AUTHKEY: ${{ secrets.TAILSCALE_AUTHKEY }}
        run: |
          echo "--- 1. Instalando Tailscale ---"
          # Instalar Tailscale usando Homebrew
          brew install tailscale

          if [ -z "$TAILSCALE_AUTHKEY" ]; then
            echo "::error::La clave TAILSCALE_AUTHKEY no est√° configurada. Tailscale no se autenticar√°."
            exit 1
          else
            # Iniciar Tailscale y autenticar
            # Configura un hostname f√°cil de identificar
            sudo tailscale up --authkey=$TAILSCALE_AUTHKEY --hostname=github-mac-runner --accept-dns=false
            echo "‚úÖ Tailscale est√° corriendo. IP Address:"
            tailscale status
          fi

      # 2. Instalar RustDesk (Opcional: puedes necesitar un VNC server)
      - name: üñ•Ô∏è Instalar RustDesk (Cask)
        run: |
          echo "--- 2. Instalando RustDesk v√≠a Homebrew Cask ---"
          # RustDesk se instala como una aplicaci√≥n GUI (Cask)
          brew install --cask rustdesk
          echo "RustDesk instalado en /Applications/RustDesk.app"

      # 3. Mantener el flujo de trabajo activo
      - name: ‚è≥ Mantener el Runner Vivo para Acceso Remoto
        run: |
          echo "--- 3. Manteniendo la Sesi√≥n Abierta (M√°x 360 minutos) ---"
          # Este comando detiene la ejecuci√≥n del flujo de trabajo por 6 horas (21600 segundos).
          # El trabajo terminar√° autom√°ticamente al alcanzar el l√≠mite de 'timeout-minutes'.
          sleep 21600
